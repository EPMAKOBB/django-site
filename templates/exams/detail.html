{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ exam.subject.name }} — {{ exam.name }}{% endblock %}

{% block content %}
<section class="section">
  <div class="container">
    <h1 class="section-title">{{ exam.subject.name }} — {{ exam.name }}</h1>
    {% if blueprint %}
      <p class="muted">{% trans "Чертёж экзамена найден, можно собрать персональный вариант." %}</p>
      <form method="post" class="mb-16">
        {% csrf_token %}
        <input type="hidden" name="action" value="build_personal">
        <button type="submit" class="btn btn-large btn-primary" style="display:block;margin:0 auto;">
          {% trans "Составить персональный вариант" %}
        </button>
      </form>
    {% else %}
      <div class="alert alert-warning">
        {% trans "Для этой версии экзамена пока нет активного чертежа." %}
      </div>
    {% endif %}
  </div>
</section>

<section class="section">
  <div class="container">
    <h3 class="section-title">{% trans "Статические варианты" %}</h3>
    {% if static_variants %}
      <div class="variant-buttons">
        {% for variant in static_variants %}
          {% if variant.page %}
            <a class="btn btn-secondary btn-large" href="{% url 'variant-page' variant.page.slug %}">{{ variant.name }}</a>
          {% else %}
            <button class="btn btn-secondary btn-large" disabled>{{ variant.name }}</button>
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">{% trans "Пока нет опубликованных готовых вариантов." %}</p>
    {% endif %}
  </div>
</section>

<section class="section">
  <div class="container">
    <h3 class="section-title">{% trans "Типы заданий" %}</h3>
    {% if task_rows %}
      <div class="cards-grid">
        {% for row in task_rows %}
          <div class="card">
            <div class="muted">№ {{ row.type.display_order }}</div>
            <h4>{{ row.type.name }}</h4>
            {% if row.item %}
              <p class="hint">{% trans "Вариант" %}: {{ row.item.count }} ×</p>
              {% if row.item.section %}<p class="hint">{% trans "Часть" %}: {{ row.item.section }}</p>{% endif %}
            {% endif %}
            {% if row.progress %}
              <div class="progress" style="height:6px;">
                <div class="progress-bar" style="width:{{ row.progress_pct }}%;"></div>
              </div>
              <p class="hint">{% trans "Уровень" %}: {{ row.progress.effective_mastery|floatformat:2 }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">{% trans "Список типов задач пока пуст." %}</p>
    {% endif %}
  </div>
</section>

{% if skill_masteries %}
<section class="section">
  <div class="container">
    <h3 class="section-title">{% trans "Ваши скиллы" %}</h3>
    <div class="cards-grid">
      {% for mastery in skill_masteries %}
        <div class="card">
          <h4>{{ mastery.skill.name }}</h4>
          <p class="hint">{% trans "Уровень" %}: {{ mastery.mastery|floatformat:2 }}</p>
          <p class="muted">{% trans "Уверенность" %}: {{ mastery.confidence|floatformat:2 }}</p>
        </div>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}
{% endblock %}
